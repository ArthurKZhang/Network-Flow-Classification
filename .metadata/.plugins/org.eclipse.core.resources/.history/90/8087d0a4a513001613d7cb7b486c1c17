package arthur.dao.Mongo;

import org.bson.Document;

import com.mongodb.MongoClient;
import com.mongodb.client.MongoCollection;
import com.mongodb.client.MongoDatabase;

import arthur.bean.data.IPPacket;

public class DBHelperIPPacket implements ConfigIPPacket {
	public static boolean createCollection() {
		MongoClient mongoClient = new MongoClient(HOST, PORT);
		MongoDatabase db = mongoClient.getDatabase(DB_NAME);
		try {
			db.createCollection(COLLECTION_NAME);
			return true;
		} catch (Exception e) {
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
			return false;
		}finally {
			mongoClient.close();
		}
	}

	public static boolean save(IPPacket ipp) {
		try {
			// 连接到 mongodb 服务
			MongoClient mongoClient = new MongoClient("localhost", 27017);

			// 连接到数据库
			MongoDatabase mongoDatabase = mongoClient.getDatabase("BS");
			System.out.println("Connect to database successfully");

			mongoDatabase.createCollection("IPPacket");
			MongoCollection<Document> collection = mongoDatabase.getCollection("IPPacket");
			Document ipPacket = new Document("time_s", ipp.getTime_s()).append("time_ms", ipp.getTime_ms())
					.append("size", ipp.getSize()).append("sourceAddress", ipp.get_5tuple().getSouAddress())
					.append("destinAddress", ipp.get_5tuple().getDesAddress())
					.append("sourcePort", ipp.get_5tuple().getSouPort())
					.append("destinAddress", ipp.get_5tuple().getDesPort())
					.append("protocol", ipp.get_5tuple().getProtocol());
			collection.insertOne(ipPacket);
			return true;
		} catch (Exception e) {
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
			return false;
		}
	}
}
