package data.alg.arthur;

import java.util.HashMap;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;

import dao.databean.arthur.IPPacket;
import dao.databean.arthur.NetworkFlow;

public class DataTransAlgorithm {
	/**
	 * 
	 * @return
	 */
	// 对每个包，得到五元组的hashcode，然后把相同hashcode的包放到一个流里面。这个hashcode就是这个map的key
	public static Map<Integer, NetworkFlow> packets2NetworkFlow(List<IPPacket> packets) {
		// each key(Integer) defines a class(network flow) of packets.
		Map<Integer, NetworkFlow> map = new HashMap<Integer, NetworkFlow>();
		for (IPPacket p : packets) {
			int hashcode = p.get_5tuple().hashCode();
			NetworkFlow flow = getNetworkFlowBy5THsah(hashcode, flowList);
			// map.put(key, value)
		}
		return null;
	}

	public static List<NetworkFlow> packets2NetworkFlowl(List<IPPacket> packets) {
		List<NetworkFlow> flowList = new LinkedList<NetworkFlow>();
		for (IPPacket p : packets) {
			int hashcode = p.get_5tuple().hashCode();
			NetworkFlow flow = getNetworkFlowBy5THsah(hashcode, flowList);
			if (flow == null) {
				flow = new NetworkFlow();
				flow.set_5tuple(p.get_5tuple());
				LinkedList<IPPacket> l = new LinkedList<IPPacket>();
				l.add(p);
				flow.setPacketList(l);
				flowList.add(flow);
			}
		}
		return flowList;
	}

	private static NetworkFlow getNetworkFlowBy5THsah(int hashcode, Map<Integer, NetworkFlow> flowMap) {
		if (flowMap.size() == 0 && !flowMap.containsKey(new Integer(hashcode))) {
			return null;
		}
		NetworkFlow nf = flowMap.get(new Integer(hashcode));
		return nf;
	}

	private static NetworkFlow getNetworkFlowBy5THsah(int hashcode, List<NetworkFlow> flowList) {
		if (flowList.size() == 0) {
			return null;
		}
		for (NetworkFlow flow : flowList) {
			if (flow.get_5tuple().hashCode() == hashcode) {
				return flow;
			}
		}
		return null;
	}
}
